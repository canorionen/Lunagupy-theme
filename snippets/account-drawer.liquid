{%- doc -%}
  Renders the account drawer, which is used for mobile users.
{%- enddoc -%}

<script
  src="{{ 'dialog.js' | asset_url }}"
  type="module"
></script>

<dialog-component
  class="account-drawer"
  {{ block.shopify_attributes }}
>
  {% render 'account-button', attributes: 'on:click="/showDialog"' %}
  <dialog
    ref="dialog"
    class="color-{{ settings.popover_color_scheme }} dialog-modal dialog-drawer dialog-bottom-sheet account-drawer__dialog"
    scroll-lock
    aria-labelledby="account-drawer-heading"
  >
    <button
      ref="closeButton"
      on:click="/closeDialog"
      class="button button-unstyled close-button account-drawer__close-button"
      aria-label="{{ 'actions.close_dialog' | t }}"
      autofocus
    >
      <span
        class="svg-wrapper"
        aria-hidden="true"
      >
        {{- 'icon-close.svg' | inline_asset_content -}}
      </span>
    </button>
    {% render 'account-actions' %}
  </dialog>
</dialog-component>

{% stylesheet %}
  .account-drawer {
    @media screen and (min-width: 750px) {
      display: none;
    }
  }

  .account-drawer__dialog {
    --animation-speed: 0.24s;
    --dialog-drawer-opening-animation: account-drawer-slide-in;
    --dialog-drawer-closing-animation: account-drawer-slide-out;

    /* LIQUID GLASS TRANSFORMATION */
    height: fit-content;
    margin: 0;
    
    /* Float from bottom */
    position: fixed !important;
    bottom: 20px !important; 
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: calc(100vw - 30px) !important;
    max-width: 400px !important;
    
    inset-block-end: auto !important; /* Override default inset */
    inset-block-start: auto;

    /* Glass Effect */
    background-color: rgba(255, 255, 255, 0.65) !important;
    backdrop-filter: blur(25px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(25px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0 20px 50px rgba(0,0,0,0.12) !important;
    border-radius: 24px !important;
    padding: 0;
    
    /* Ensure transparency propagates */
    &::backdrop {
      background-color: rgba(0, 0, 0, 0.2); /* Dim background slightly */
    }
  }

  .account-drawer__close-button {
    z-index: 1;
    inset-block-start: var(--padding-xs);
    inset-inline-end: var(--padding-xs);
    color: var(--color-foreground);
    background-color: transparent;
  }

  .account-drawer__close-button .svg-wrapper {
    display: flex;
    width: var(--button-size);
    height: var(--button-size);
    align-items: center;
    justify-content: center;
  }
  
  /* Force inner content to be transparent so glass shows through */
  .account-drawer .account-actions {
    background-color: transparent !important;
  }

  @keyframes account-drawer-slide-in {
    from {
      transform: translate(-50%, 120%);
      opacity: 0;
    }

    to {
      transform: translate(-50%, 0);
      opacity: 1;
    }
  }

  @keyframes account-drawer-slide-out {
    from {
      transform: translate(-50%, 0);
      opacity: 1;
    }

    to {
      transform: translate(-50%, 120%);
      opacity: 0;
    }
  }
{% endstylesheet %}
